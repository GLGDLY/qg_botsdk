# 快速入门

本内容将引导您从安装开始，到实装您的第一个可运行机器人。

## 安装

-   下载python： <https://www.python.org/downloads/>

-   推荐python版本：3.9+

-   安装python可参考：<https://www.liaoxuefeng.com/wiki/1016959663602400/1016959856222624>

-   安装python后，直接使用pip安装即可，系统会自动安装SDK和其两个依赖包（更多关于pip的资讯可参考<https://www.runoob.com/w3cnote/python-pip-install-usage.html>）

```bash
pip install qg-botsdk
```

```shell
# 需要注意 windows cmd 下的 pip 方法：
python -m pip install qg-botsdk
```

-   另也可使用pycharm方便编程：具体操作教程如下：<https://www.runoob.com/w3cnote/pycharm-windows-install.html>

## 注册机器人

官方机器人简介文档：<https://bot.q.qq.com/wiki/##%E7%AE%80%E4%BB%8B>

官方机器人快速注册指南：<https://cloud.tencent.com/lab/courseDetail/1005936350069241>

注册后，可在“机器人平台后台管理端-开发-开发设置”找到三个关键票据，当中BotAppID是机器人ID，机器人令牌为机器人token，机器人密钥为机器人secret。

![](https://tcs.teambition.net/storage/312hb6cc684fd429fe16f754625fa71846ca?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY2MTE0OTQ4NywiaWF0IjoxNjYwNTQ0Njg3LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmhiNmNjNjg0ZmQ0MjlmZTE2Zjc1NDYyNWZhNzE4NDZjYSJ9.74YpOzG4EbXRV-_1glD_YNe69AyVdABJLtn-zi1TU4A&download=image.png)

| 票据         | 对应的名称    | 描述                                       |
| ---------- | -------- | ---------------------------------------- |
| bot_app_id | BotAppID | 用于识别一个机器人的 id（可理解为登录机器人的账号ID）            |
| bot_token  | 机器人令牌    | 机器人token，用于以机器人身份调用api（可理解为登录机器人的密码）     |
| bot_secret | 机器人密钥    | 用于在 oauth 场景进行请求签名的密钥（主要可用于调用腾讯内容安全检测接口） |

## 创建并使用

下载sdk后，即可创建一个新的.py档案，并透过import载入SDK内容：

```python
from qg_botsdk import BOT
```

import后实例化BOT，并载入机器人bot_id（BotAppID）和bot_token（机器人令牌）：

```python
bot = BOT(bot_id='xxx', bot_token='xxx')
# 如为公域机器人，需传入is_private参数，如下：
# bot = BOT(bot_id='xxx', bot_token='xxx'，is_private=False)
```

之后，便可以编写一个简单的接收事件函数，当中的data是最上层包含所有数据的一个物件，而data之下衍生的：treated_msg是经过处理（包括去除艾特机器人的字段、去除/字段等）的内容、id代表的是msg_id消息ID、channel_id代表的是子频道ID：

```python
def deliver(data):
    if '你好' in data.treated_msg:
        bot.api.send_msg(data.channel_id, '你好世界', message_id=data.id)
		# 注意v2.2.0或以下的sdk版本为bot.send_msg()
```

而同时，可以从model库调用模型数据，验证如data.channel_id，data.id等的结构是否存在：

```python
from qg_botsdk import Model   # 导入数据模型


def deliver(data: Model.MESSAGE):   # Model.MESSAGE为导入的一个数据模型
    if '你好' in data.treated_msg:
        bot.api.send_msg(data.channel_id, '你好世界', message_id=data.id)
		# 注意v2.2.0或以下的sdk版本为bot.send_msg()
```

并注册该函数到实例化的BOT中：

```python
bot.bind_msg(deliver)
```

最后，开始运行机器人：

```python
bot.start()
```

因此，完整的代码流程为：

```python
# 导入SDK核心类（BOT）、所有数据模型（Model）
from qg_botsdk import BOT, Model


def deliver(data: Model.MESSAGE):   # 创建接收消息事件的函数并绑定数据模型
    if '你好' in data.treated_msg:   # data.treated_msg 为消息内容
        bot.api.send_msg(data.channel_id, '你好世界', message_id=data.id)
        # data.id 为消息ID，data.channel_id 为子频道ID
		# 注意v2.2.0或以下的sdk版本为bot.send_msg()


bot = BOT(bot_id='xxx', bot_token='xxx') # 实例化SDK核心类
bot.bind_msg(deliver)  # 绑定接收消息事件的函数
bot.start()  # 开始运行机器人
```

使用上述代码，并填入bot_id（BotAppID）和bot_token（机器人令牌）后，可直接开始运行机器人。当在添加了相应机器人的QQ频道中，输入”你好”或“/你好”，机器人随之会回复”你好，世界”

> 可通过添加`is_sandbox=True`参数到实例化的核心类中，开启沙箱环境进行测试，整体指令如下：`BOT(bot_id='xxx', bot_token='xxx', is_sandbox=True)`

-   沙箱环境定义：

![](https://tcs.teambition.net/storage/312h65f8fa9d7bc3b9facc58430f2792edef?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY2MTE0OTQ4NywiaWF0IjoxNjYwNTQ0Njg3LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmg2NWY4ZmE5ZDdiYzNiOWZhY2M1ODQzMGYyNzkyZWRlZiJ9.Xb2_Yj9zlrOIDTje4d09NMQya_WPr6aS6-rcgqz4r0Q&download=image.png)

-   沙箱频道路径 ：机器人平台后台管理端-设置-沙箱频道

![](https://tcs.teambition.net/storage/312h80f4612ddb027c87f1c6d99aa8cc2d21?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY2MTE0OTQ4NywiaWF0IjoxNjYwNTQ0Njg3LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmg4MGY0NjEyZGRiMDI3Yzg3ZjFjNmQ5OWFhOGNjMmQyMSJ9.33qxcf_1Uoab59OGuazvef5_1q-UllH5Wtla41b-uew&download=%E8%83%8C%E6%99%AF.png)

## 额外功能

qg_botsdk 提供了检查数据结构的模型，导入方法如下：

```python
from qg_botsdk import Model   # 导入数据模型
```

导入后，即可透过类型提示（data: MESSAGE）的方法验证数据结构正确性：

```python
def deliver(data: Model.MESSAGE):  # Model.MESSAGE为导入的一个数据模型
    if '你好' in data.treated_msg:
        bot.api.send_msg(data.channel_id, '你好世界', message_id=data.id)
```

当使用数据子项时，你使用的IDE理论上将会有相应的子数据结构提示：

![](https://tcs.teambition.net/storage/312h04079b9ba97c71d1ebf09cbb23a21251?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY2MTE0OTQ4NywiaWF0IjoxNjYwNTQ0Njg3LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmgwNDA3OWI5YmE5N2M3MWQxZWJmMDljYmIyM2EyMTI1MSJ9.dsGRRRtoJKDbuUBzMC160yQc8ZIBZ4ZYwDUKTxzBe9M&download=image.png)

而当输入错误的数据结构（正确的字段名为`channel_id`，而非`channelid`）时，你使用的IDE理论上将会提示错误：

![](https://tcs.teambition.net/storage/312h5bb110f07c23159dd1a92a10fdb5f305?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY2MTE0OTQ4NywiaWF0IjoxNjYwNTQ0Njg3LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmg1YmIxMTBmMDdjMjMxNTlkZDFhOTJhMTBmZGI1ZjMwNSJ9.IIEq2ws_ms7M0n9Mniwu7LbCSkEa7Exoakdkm8SmRBk&download=image.png)

## 提审

在开发完机器人的指令功能后，请注意大家需要**切换到正式环境**后再在机器人平台后台提交审核，具体方法为在实例化`BOT(bot_id='xxx', bot_token='xxx')`时添加一个参数：

```python
bot = BOT(bot_id='xxx', bot_token='xxx', is_sandbox=False)
```

这个`is_sandbox`的参数代表是否使用沙箱环境，当其为False时则代表使用正式环境，切换后就可以前去提交审核了。

更多实例化BOT()时可使用的参数请参阅{any}`SDK组件-主要组件 <实例化机器人>`。

## 更多工作流实例

可查看github中的example库：

<https://github.com/GLGDLY/qg_botsdk/tree/master/example>
